<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <title>Route Visualizer</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">




    <link rel="stylesheet" href="styles.css" />
</head>

<body>
    <div class="top-bar">
        <img src="https://www.lkw-walter.com/static/assets/images/logos/LKW-Logo-RGB-NEG-220.svg?v=2025.4.3.720.cefca94f"
             alt="LKW Walter Logo">
    </div>

    <div id="overview-view">
        <h2>Transports Overview</h2>
        <table id="transports-table" class="table">
            <thead>
                <tr>
                    <th>Transport ID</th>
                    <th>Created At</th>
                    <th>External Transport ID</th>
                    <th>External Booking ID</th>
                    <th>Partner ID</th>
                    <th>Onloading</th>
                    <th>Offloading</th>
                </tr>
            </thead>
            <tbody>
                <!-- Data will be inserted here -->
            </tbody>
        </table>
    </div>

    <div id="map-view">
        <div id="map"></div>
        <div class="info-box" id="infoBox">
            Total route distance: ...<br>
            Total gap distance: ...
        </div>
    </div>


    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>

    <script src="routing.js"></script>
    <script>
        document.addEventListener("DOMContentLoaded", async function () {
            const $tbody = $('#transports-table tbody');
            $tbody.empty();
            try {
                const response = await fetch('https://haymnoqetihmdnykhrdo.supabase.co/functions/v1/get-transports');
                const data = await response.json();
                data.forEach(item => {
                    // Parse onloading/offloading details (fix single quotes)
                    let onloading = item.onloading_details.replace(/'/g, '"');
                    let offloading = item.offloading_details.replace(/'/g, '"');
                    try { onloading = JSON.parse(onloading); } catch { onloading = {}; }
                    try { offloading = JSON.parse(offloading); } catch { offloading = {}; }
                    $tbody.append(`<tr>
                        <td>${item.transport_id}</td>
                        <td>${item.created_at}</td>
                        <td>${item.external_transport_id}</td>
                        <td>${item.external_booking_id}</td>
                        <td>${item.partner_id}</td>
                        <td>${onloading.name || ''} (${onloading.day || ''})</td>
                        <td>${offloading.name || ''} (${offloading.day || ''})</td>
                    </tr>`);
                });
            } catch (error) {
                $tbody.append('<tr><td colspan="7">Failed to load data</td></tr>');
            }
        });
    </script>

</body>

</html>